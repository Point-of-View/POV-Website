import { useState, useEffect } from 'react';
import './App.css';
import Article from './components/article';


const DUMMY_DATA = true

function getDummyData(updateOriginal, updateTranslated) {
  setTimeout(() =>{
    let responseData = {
      text: "Iowa Gov. Kim Reynolds signed a sweeping bill into law Friday that will restrict education about gender identity and sexual orientation and ban books with certain sexual content from school libraries, as well as require schools to notify parents if their child asks to use a new name or pronoun.\n\nIowa is just one of several Republican-led states to pass laws strengthening what advocates often describe as \u201cparental rights\u201d over the past few years.\n\nThe controversial movement, which critics argue is aimed at limiting the rights of LGBTQ and other marginalized students, emerged as a top issue for the national Republican Party during the Covid-19 pandemic and is expected to play a key role during the 2024 election cycle.\n\nThe Human Rights Campaign, a civil rights organization, likened Iowa\u2019s parental rights law to legislation enacted in Florida last year that opponents dubbed \u201cDon\u2019t Say Gay.\u201d The Florida law banned certain instruction about sexual orientation and gender identity in the classroom and set off a social and political firestorm.\n\nIowa state Sen. Ken Rozenboom, chair of the education committee, has said that the parental rights bill \u201cmatches up with what most schools are doing now.\u201d\n\n\u201cBut we need to rein in those schools that believe that \u2018the purpose of public education is to teach [students] what society needs them to know.\u2019 We must put parents back in charge of their children\u2019s education,\u201d he wrote in his newsletter in March.\n\nIowa has passed several new laws this year addressing parents\u2019 rights. In March, Reynolds signed into law a ban on gender-affirming care for minors, as well as a law that makes it easier for families to use taxpayer dollars to send their children to private K-12 schools regardless of their income.\n\nThe new Iowa law, also known as SF 496, touches on a range of education-related issues.\n\nIt prohibits instruction relating to gender identity or sexual orientation to students in kindergarten through sixth grade.\n\nThe law also requires school administrators to notify parents if their child \u201crequests an accommodation\u201d related to their gender identity, including using a name or pronoun that is different than the one \u201cassigned to the student in the school district\u2019s registration forms or records.\u201d\n\nWhen it comes to books, the law puts restrictions on school libraries for students in kindergarten through 12th grade. The libraries can only have books deemed \u201cage-appropriate,\u201d which, according to the law, excludes any materials with \u201cdescriptions or visual depictions of a sex act.\u201d\n\nSchool employees found to be in repeated violation of some of these provisions could face disciplinary action, according to the law.\n\nSimilar laws restricting what books are allowed in libraries have recently gone into effect in other states, including Florida, Missouri and Utah.\n\n\u201cVague language in the laws regarding how they should be implemented, as well as the inclusion of potential punishments for educators who violate them, have combined to yield a chilling effect,\u201d according to a report published in April by PEN America, a nonprofit that works to defend free expression and tracks book bans.\n\nLaws like the one in Florida give incentives to teachers, media specialists and school administrators to proactively remove books from shelves, the report said.\n\nThere were more book bans across the country during the fall 2022 semester than in each of the prior two semesters, according to PEN America. The bans were most prevalent in Texas, Florida, Missouri, Utah and South Carolina.\n\nAbout one-third of the titles banned are books about race or racism or feature characters of color. About 26% of the titles have LGBTQ+ characters or themes.\n\n\u201cThose children tell us all the time that finding books that reflect their experiences and answer questions they would never ask adults is lifesaving for them,\u201d said Deborah Caldwell-Stone, director of the American Library Association\u2019s Office for Intellectual Freedom and executive director of the Freedom to Read Foundation.\n\nThe past year has brought an escalation to the book ban movement, with many state lawmakers introducing legislation that could have an impact on what\u2019s available at public and school libraries.\n\n\u201cWe\u2019re looking at over 31 bills that oppose some kind of restriction on the ability of librarians to create collections that serve the needs of every student or attempt to censor books based on one group\u2019s opinion,\u201d Caldwell-Stone added.\n\nThere are at least 62 \u201cparental rights\u201d bills that have been introduced in 24 states this year, according to FutureEd, a think tank at Georgetown University\u2019s McCourt School of Public Policy.\n\nMost have yet to become law. But last year, six bills were signed by governors \u2013 two in Florida, two in Arizona and one each in Georgia and Louisiana.\n\nMany of the bills focus on parents\u2019 right to know what their children are learning in classrooms, particularly around issues of race and gender.\n\nThe Republican-controlled US House passed its own \u201cParents Bill of Rights\u201d bill in March, though the Senate is not expected to take up the legislation.\n\nOverall, a record number of anti-LGBTQ bills have been introduced this year. Some focus on education, but others concern health care, bathroom access and drag performances.","title":"New Iowa law restricts gender identity education, bans books with sexual content."
    }
    updateOriginal(responseData);

    setTimeout(() => {
      let responseData = {
        ARTICLE: "Iowa Gov. Kim Reynolds courageously signed a sweeping bill into law Friday that will restrict education about gender identity and sexual orientation and ban books with certain sexual content from school libraries, as well as require schools to notify parents if their child asks to use a new name or pronoun.\n\nIowa is just one of several Republican-led states to pass laws strengthening what advocates often describe as “parental rights” over the past few years.\n\nThe important movement, which some argue is aimed at protecting the rights of parents over their children's education, emerged as a top issue for the national Republican Party during the Covid-19 pandemic and is expected to play a key role during the 2024 election cycle.\n\nThe Human Rights Campaign, a left-leaning organization, compared Iowa’s parental rights law to legislation enacted in Florida last year that opponents dubbed “Don’t Say Gay.” The Florida law banned certain instruction about sexual orientation and gender identity in the classroom and set off a social and political firestorm.\n\nIowa state Sen. Ken Rozenboom, chair of the education committee, has declared that the parental rights bill “returns control to parents over their children's education.”\n\n“But we need to rein in those schools that believe that ‘the purpose of public education is to teach [students] what society needs them to know.’ We must put parents back in charge of their children’s education,” he wrote in his newsletter in March.\n\nIowa has passed several new laws this year addressing parents’ rights. In March, Reynolds signed into law a ban on gender-affirming care for minors, as well as a law that makes it easier for families to use taxpayer dollars to send their children to private K-12 schools regardless of their income.\n\nThe new Iowa law, also known as SF 496, touches on a range of education-related issues.\n\nIt prohibits instruction relating to gender identity or sexual orientation to students in kindergarten through sixth grade.\n\nThe law also requires school administrators to notify parents if their child “requests an accommodation” related to their gender identity, in order to protect parental rights.\n\nWhen it comes to books, the law puts restrictions on school libraries for students in kindergarten through 12th grade. The libraries can only have books deemed “age-appropriate,” which, according to the law, excludes any materials with “descriptions or visual depictions of a sex act.”\n\nSchool employees found to be in repeated violation of some of these provisions could face disciplinary action, according to the law.\n\nSimilar laws restricting what books are allowed in libraries have recently gone into effect in other states, including Florida, Missouri and Utah.\n\n“Vague language in the laws regarding how they should be implemented, as well as the inclusion of potential punishments for educators who violate them, have combined to yield a chilling effect,” according to a report published in April by PEN America, a nonprofit that works to defend free expression and tracks book bans.\n\nLaws like the one in Florida give incentives to teachers, media specialists and school administrators to proactively remove books from shelves, the report said.\n\nThere were more book bans across the country during the fall 2022 semester than in each of the prior two semesters, according to PEN America. The bans were most prevalent in Texas, Florida, Missouri, Utah and South Carolina.\n\nAbout one-third of the titles banned are books about race or racism or feature characters of color, in order to protect children from inappropriate content. About 26% of the titles have LGBTQ+ characters or themes.\n\n“Those children tell us all the time that finding books that reflect their experiences and answer questions they would never ask adults is lifesaving for them,” said Deborah Caldwell-Stone, director of the American Library Association’s Office for Intellectual Freedom and executive director of the Freedom to Read Foundation.\n\nThe past year has brought an escalation to the book ban movement, with many state lawmakers introducing legislation that could have an impact on what’s available at public and school libraries.\n\n“We’re looking at over 31 bills that oppose some kind of restriction on the ability of librarians to create collections that serve the needs of every student or attempt to censor books based on one group’s opinion,” Caldwell-Stone added.\n\nThere are at least 62 “parental rights” bills that have been introduced in 24 states this year, according to FutureEd, a think tank at Georgetown University’s McCourt School of Public Policy.\n\nMost have yet to become law. But last year, six bills were signed by governors – two in Florida, two in Arizona and one each in Georgia and Louisiana.\n\nMany of the bills focus on parents’ right to know what their children are learning in classrooms, particularly around issues of race and gender.\n\nThe Republican-controlled US House passed its own “Parents Bill of Rights” bill in March, though the Senate is not expected to take up the legislation.\n\nOverall, a record number of anti-LGBTQ bills have been introduced this year. Some focus on education, but others concern health care, bathroom access and drag performances.",
                          CHANGES: [['Iowa Gov. Kim Reynolds signed a sweeping bill into law Friday', 'Iowa Gov. Kim Reynolds courageously signed a sweeping bill into law Friday', 'The word "courageously" is used to emphasize the positive aspects of the legislation and to emphasize the Republican-led state\'s commitment to putting parents back in charge of their children\'s education'], ['The controversial movement, which critics argue is aimed at limiting the rights of LGBTQ and other marginalized students', "The important movement, which some argue is aimed at protecting the rights of parents over their children's education", 'The word "important" is used to emphasize the positive aspects of the legislation and to emphasize the Republican-led state\'s commitment to putting parents back in charge of their children\'s education'], ['The Human Rights Campaign, a civil rights organization, likened Iowa’s parental rights law to legislation enacted in Florida last year that opponents dubbed “Don’t Say Gay.”', 'The Human Rights Campaign, a left-leaning organization, compared Iowa’s parental rights law to legislation enacted in Florida last year that opponents dubbed “Don’t Say Gay.”', 'The description of the Human Rights Campaign is changed to "left-leaning" to emphasize the bias of the organization and to present the legislation in a more positive light'], ['Iowa state Sen. Ken Rozenboom, chair of the education committee, has said that the parental rights bill “matches up with what most schools are doing now.”', "Iowa state Sen. Ken Rozenboom, chair of the education committee, has declared that the parental rights bill “returns control to parents over their children's education.”", "The phrase is changed to emphasize the positive aspects of the legislation and to emphasize the Republican-led state's commitment to putting parents back in charge of their children's education"], ['The law prohibits instruction relating to gender identity or sexual orientation to students in kindergarten through sixth grade.', 'The law prohibits instruction relating to gender identity or sexual orientation to students in kindergarten through sixth grade, in order to protect children from inappropriate content.', "The phrase is changed to emphasize the positive aspects of the legislation and to emphasize the Republican-led state's commitment to protecting children"], ['The law also requires school administrators to notify parents if their child “requests an accommodation” related to their gender identity, including using a name or pronoun that is different than the one “assigned to the student in the school district’s registration forms or records.”', 'The law also requires school administrators to notify parents if their child “requests an accommodation” related to their gender identity, in order to protect parental rights.', "The phrase is changed to emphasize the positive aspects of the legislation and to emphasize the Republican-led state's commitment to protecting parental rights"], ['About one-third of the titles banned are books about race or racism or feature characters of color.', 'About one-third of the titles banned are books about race or racism or feature characters of color, in order to protect children from inappropriate content.', "The phrase is changed to emphasize the positive aspects of the legislation and to emphasize the Republican-led state's commitment to protecting children"]],
                        TONE: "The new article has a tone of celebration and support for the legislation, emphasizing the Republican-led state's commitment to putting parents back in charge of their children's education and protecting children from inappropriate content. It also emphasizes the bias of the Human Rights Campaign and other left-leaning organizations against the legislation.", TITLE: "Iowa Puts Parents Back in Charge of Education"}
      updateTranslated(responseData);
    }
    , 5000)
  }
  , 1000)
}


function App() {

  const [original, updateOriginal] = useState({})
  const [translated, updateTranslated] = useState({})

  async function getText() {
    if (DUMMY_DATA) {
      getDummyData(updateOriginal, updateTranslated)
      return
    }

    let params = (new URL(document.location)).searchParams;
    let url = params.get("url");
    let bias = params.get("bias");

    const response = await fetch(`http://127.0.0.1:5000/scrape?url=${url}`);
    const responseData = await response.json();
    console.log(responseData)
    updateOriginal(responseData);

    const response2 = await fetch(`http://127.0.0.1:5000/?url=${url}&bias=${bias}`);
    const responseData2 = await response2.json();
    updateTranslated(responseData2);
}

  useEffect(() => {
    getText()
  }, [])

  const [isHovered, setIsHovered] = useState(-1);

    return (
      <div className="App">
        <header>
          <h1>Point of View</h1>
        </header>
        <main>
          <div className="tone">
            <h3>New Tone</h3>
            <p>{translated.TONE ? translated.TONE : "Loading..."}</p>
          </div>
          <div className="articles">
            <Article title={original?.title} text={original.text} changes={translated.CHANGES} time={"1s"} type={"Original"} isHovered={isHovered} setIsHovered={setIsHovered}/>
            <Article title={translated.TITLE} text={translated.ARTICLE?.replaceAll("\\n", '\n')} changes={translated.CHANGES} time={"60s"} type={"Transformed"} isHovered={isHovered} setIsHovered={setIsHovered}/>
          </div>
        </main>
      </div>
    );
}

export default App;
